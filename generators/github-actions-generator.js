import { join } from 'node:path';
import { writeFileSafe } from '../utils/fs-helpers.js';

/**
 * Generate GitHub Actions workflow for bmad-swarm validation.
 * @param {string} projectRoot - Project root directory
 * @returns {string} Path to generated workflow file
 */
export function generateGitHubWorkflow(projectRoot) {
  const workflowDir = join(projectRoot, '.github', 'workflows');
  const workflowPath = join(workflowDir, 'bmad-validate.yml');

  const content = `# BMAD Swarm - Artifact Validation Workflow
# Generated by bmad-swarm init --github
# Runs artifact validation on pull requests to catch quality issues early.

name: BMAD Validate

on:
  pull_request:
    branches: [main, master]
    paths:
      - 'artifacts/**'
      - 'swarm.yaml'

jobs:
  validate:
    name: Validate Artifacts
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install bmad-swarm
        run: npm install -g bmad-swarm

      - name: Validate artifacts
        run: bmad-swarm validate

      - name: Health check
        run: bmad-swarm doctor
`;

  writeFileSafe(workflowPath, content);
  return workflowPath;
}
